

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Curve Fitting &#8212; Climate Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter_1/Fitting';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hypothesis Testing And Goodness of Fit" href="Hypothesis_Testing.html" />
    <link rel="prev" title="Global \(\textrm{CO}_2 \)" href="Data_Exploration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/DurhamUniversityMasterLogo_RGB.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/DurhamUniversityMasterLogo_RGB.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapter_0, Intro</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../An_Aside_On_Python.html">An Aside On Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../editing_the_book.html">Editing The Book</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapter 1, Global Carbon Dioxide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Data_Exploration.html">Global <span class="math notranslate nohighlight">\(\textrm{CO}_2 \)</span></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Curve Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hypothesis_Testing.html">Hypothesis Testing And Goodness of Fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Final_Model.html">Final Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="predictive_models.html">Predictive Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="temp_co2.html">Global Temperature Predictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="3models.html">Polynomial Prediction Problems</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapter 2, Radiation Modelling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/atmospheric_primer.html">Radiation Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/blackbody.html">Incoming and Outgoing Radiation</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/lorentzian_broadening.html">The Variance of Absorption Spectra</a></li>





<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/radiative_transfer.html">Radiative transfer</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/Optical_depth_db.html">The Optical Depths Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/atmosphere_model.html">Radiative Transfer Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix, Relational Database Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Database_Chapter/Database_intro_1.html">A very short introduction to relational databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Database_Chapter/Database_intro_2.html">The Relational Alternative</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix, SimpleTrans</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Chapter_SimpleTrans/SimpleTrans.html">SimpleTrans</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/seancraven/CDS_book/master?urlpath=tree/docs/Chapter_1/Fitting.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter_1/Fitting.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Curve Fitting</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fitting">Least-Squares Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-curve-fitting-to-textrm-co-2-data">Applying Curve Fitting to <span class="math notranslate nohighlight">\(\textrm{CO}_2\)</span> Data</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="curve-fitting">
<h1>Curve Fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this headline">#</a></h1>
<p>Fitting enables the identification of trends and behaviours in datasets. A fit describes a model of the data matched to the dataset. The fit produced can then be used to identify outliers or predict future behaviour. Much effort has been applied to modelling and exotic numerical techniques like neural networks and gradient trees are widely used today. This Section will focus on least-squares fitting of curves and goodness of fit metrics.</p>
<p>In the context of the <span class="math notranslate nohighlight">\(\textrm{CO}_2\)</span> data, this chapter is interested in the behaviour of the year 2020 in comparison to previous years.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<section id="least-squares-fitting">
<h2>Least-Squares Fitting<a class="headerlink" href="#least-squares-fitting" title="Permalink to this headline">#</a></h2>
<p>When performing curve fitting, the method of non-linear least-squares fitting is typically appropriate. The principle behind least-squares fitting is reducing the residual between the data and the fit. The N point residual for a scalar function,</p>
<div class="math notranslate nohighlight" id="equation-residuals">
<span class="eqno">(1)<a class="headerlink" href="#equation-residuals" title="Permalink to this equation">#</a></span>\[r = \sum_{i = 0}^N(y'(\vec{x_i},\vec{p})-y(\vec{x_i}))^2.\]</div>
<p>Where  <span class="math notranslate nohighlight">\(y'(\vec{x},\vec{p})\)</span>  is the model function and  <span class="math notranslate nohighlight">\(y(\vec{x})\)</span>  the data.</p>
<p>For a scalar function, the fitted line  <span class="math notranslate nohighlight">\( y'(x,\vec{p})\)</span>  is a function of the data and the free parameters of the curve <span class="math notranslate nohighlight">\( \vec{p} \in \mathbb{R}^m \)</span>. An iterative solution to minimise the residuals can be found for any non-linear problem. For the linear subclass of problems, an analytic solution to a set of equations can be found. Each residual in equation <a class="reference internal" href="#equation-residuals">(1)</a>, can be considered as its own function <span class="math notranslate nohighlight">\( r_i(\vec{p})\)</span>. The Jacobian matrix’s pseudo inverse <a class="reference internal" href="#equation-pseudo">(2)</a> corresponds to the direction each vector must change and the curvature of the error surface. The minimisation can be considered as a ball rolling down an error surface in steps. The step size is proportional to both the gradient and the curvature of the slope. A full treatment of this can be found in chapter 7 of ‘Measurements and Their Uncertainties’<span id="id1">[]</span>.</p>
<div class="math notranslate nohighlight">
\[(J_r)_{ij} = \frac{\partial r_i}{\partial p_j}\]</div>
<div class="math notranslate nohighlight" id="equation-pseudo">
<span class="eqno">(2)<a class="headerlink" href="#equation-pseudo" title="Permalink to this equation">#</a></span>\[\Delta  = - (J_r^TJ_r)^{-1}J_r^Tr(\vec{p})\]</div>
<div class="math notranslate nohighlight">
\[\vec{p}_{t+1} = \Delta \vec{p} + \vec{p}_t\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method described breifly here is the Gauss Newton algorithm, which is not used in practice. There are alternative implementations of minimising the least squarest problem depending on a multitude of factors, particularly bounds. Scipy itself uses multiple algorithms, described <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.leastsq.html#scipy.optimize.leastsq">here</a>. This method can also be extended straighforwardly to data with associated errors. The errors act as a weighting to the fit, where the weighting is inversly proportional to the error.</p>
</div>
<section id="applying-curve-fitting-to-textrm-co-2-data">
<h3>Applying Curve Fitting to <span class="math notranslate nohighlight">\(\textrm{CO}_2\)</span> Data<a class="headerlink" href="#applying-curve-fitting-to-textrm-co-2-data" title="Permalink to this headline">#</a></h3>
<p>In order to make predictions from the current data, performing a functional fit to the data and using this to extrapolate into the future is the most elementary predictive step we can take. The model takes historical training data and adjusts its parameters <span class="math notranslate nohighlight">\(\vec{p}\)</span> to emulate the data best. The simplest solution is a constant.</p>
<div class="math notranslate nohighlight" id="equation-chapter-1-fitting-0">
<span class="eqno">(3)<a class="headerlink" href="#equation-chapter-1-fitting-0" title="Permalink to this equation">#</a></span>\[y' = c\]</div>
<p>Intuitively one would draw a line to fit this data, a model with two free parameters. A polynomial fit is the higher freedom extension to this. Increased dimensions in <span class="math notranslate nohighlight">\(\vec{p}\)</span> will reduce the size of residuals. It follows that an exact fit can be found by increasing the order of the polynomial. However, this comes at a cost to the generalisability of the model. A small section of the data sets are shown below with polynomial fits, constituting under and overfitting of data.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compound_mask</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">*</span><span class="n">tuples</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enables multiple selection criteria, for example selecting both;</span>
<span class="sd">    only month 8, and year 1993.</span>

<span class="sd">    Arguments :</span>
<span class="sd">    array: pd.DataFrame, with column keys that contain</span>
<span class="sd">    *tuples: (column_key: string which is found in array.keys(),</span>
<span class="sd">        values: list of items in array[column_key]</span>
<span class="sd">        )</span>

<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame, which satisfies all of the conditions</span>
<span class="sd">    provided by the tuples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">colum_name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">:</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">colum_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">cond</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-output tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define overfit polynomial</span>
<span class="k">def</span> <span class="nf">p3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_0</span><span class="p">,</span> <span class="n">a_1</span><span class="p">,</span> <span class="n">a_2</span><span class="p">,</span> <span class="n">a_3</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a_0</span> <span class="o">+</span> <span class="n">a_1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a_2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a_3</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>


<span class="c1"># Define more reasonable poly</span>
<span class="k">def</span> <span class="nf">p1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_0</span><span class="p">,</span> <span class="n">a_1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a_0</span> <span class="o">+</span> <span class="n">a_1</span> <span class="o">*</span> <span class="n">x</span>


<span class="c1"># Define underfit poly</span>
<span class="k">def</span> <span class="nf">p0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_0</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">a_0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>


<span class="c1"># Data For Fitting</span>
<span class="n">fit_test</span> <span class="o">=</span> <span class="n">compound_mask</span><span class="p">(</span>
    <span class="n">co2_data_global</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">1992</span><span class="p">,</span> <span class="mi">1993</span><span class="p">,</span> <span class="mi">1994</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">fit_extension</span> <span class="o">=</span> <span class="n">compound_mask</span><span class="p">(</span>
    <span class="n">co2_data_global</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
    <span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1985</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)]),</span>
<span class="p">)</span>
<span class="c1"># Fit Coefs</span>
<span class="n">p0_fit</span><span class="p">,</span> <span class="n">p0_error</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">p0</span><span class="p">,</span> <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">p1_fit</span><span class="p">,</span> <span class="n">p1_error</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">p3_fit</span><span class="p">,</span> <span class="n">p3_error</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">p3</span><span class="p">,</span> <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are quite a few interesting subtlties brought up by this example.</p>
<ul class="simple">
<li><p>The P3 polynomial, does not exactly fit the datapoints on the left hand figure. This illustrates the iterative approximate solution provided by the <code class="docutils literal notranslate"><span class="pre">scipy.optimise.curvefit</span></code> function.</p></li>
<li><p>The P3 polynomial fits the data quite well above 1991. It is clear however that the polynomial is overfitting when looking at time periods before 1991, as the trendline doen’t characterise the behaviour well.</p></li>
<li><p>P3 polynomial, is the highest order polynomial for which there is one exact solution that goes through all of the data points. For P4 and above there are an infinite set of polynomials that go through 4 points.</p></li>
</ul>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># First axis</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">p0</span><span class="p">(</span><span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">p0_fit</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Underfit&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="o">.</span><span class="n">durham</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">p1</span><span class="p">(</span><span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">p1_fit</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;P1 fit&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="o">.</span><span class="n">durham</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">p3</span><span class="p">(</span><span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">p3_fit</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Overfit&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="o">.</span><span class="n">durham</span><span class="o">.</span><span class="n">purple</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">fit_test</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">1995</span><span class="p">)])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Years&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\textrm{{CO}}_2$ (ppm)&quot;</span><span class="p">)</span>
<span class="c1"># Extended Axis</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">p0</span><span class="p">(</span><span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">p0_fit</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Underfit&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="o">.</span><span class="n">durham</span><span class="o">.</span><span class="n">red</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">p1</span><span class="p">(</span><span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">p1_fit</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;P1 fit&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="o">.</span><span class="n">durham</span><span class="o">.</span><span class="n">green</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">p3</span><span class="p">(</span><span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">p3_fit</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Overfit&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">colours</span><span class="o">.</span><span class="n">durham</span><span class="o">.</span><span class="n">purple</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">],</span>
    <span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">],</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">fit_extension</span><span class="p">[</span><span class="s2">&quot;decimal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">4</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1985</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Years&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\textrm{{CO}}_2$ (ppm)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$\\textrm{{CO}}_2$ (ppm)&#39;)
</pre></div>
</div>
<img alt="../_images/88ce0c940ea36b0b9918d6a5e7ad04cd7d142933609a735d0ff65070187e57a7.png" src="../_images/88ce0c940ea36b0b9918d6a5e7ad04cd7d142933609a735d0ff65070187e57a7.png" />
</div>
</div>
<p>Underfitting, shown in red in the above figure is characterised by a model with too few free parameters to characterise the data well. Underfitting results in poor model performance and a considerable value for the residuals.</p>
<p>Overfitting behaviour, shown in purple is the opposite of underfitting, where there are too many free parameters. This is limited by most software packages as there are no unique solutions for the case where there are more free parameters than data-points. The consequence of overfitting is the poor generalisability of the model. It fits the specific dataset rather than more general trends. This, makes the predictive power of the model weak.</p>
<p>Both of these concepts are not rigid and for different applications the number of free parameters for a given dataset should be adjusted. The <span class="math notranslate nohighlight">\(\chi^2\)</span> test can determine whether a fit is acceptable for a given critical value.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter_1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Data_Exploration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Global <span class="math notranslate nohighlight">\(\textrm{CO}_2 \)</span></p>
      </div>
    </a>
    <a class="right-next"
       href="Hypothesis_Testing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Hypothesis Testing And Goodness of Fit</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fitting">Least-Squares Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-curve-fitting-to-textrm-co-2-data">Applying Curve Fitting to <span class="math notranslate nohighlight">\(\textrm{CO}_2\)</span> Data</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sean Craven
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>